@{
    ViewData["Title"] = "Dijital Kimlik Denetimi";
}

<h4 class="py-3 mb-4">
    <span class="text-muted fw-light">UI Bilesenleri /</span> Dijital Kimlik Denetimi
</h4>

<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bx bx-id-card text-primary me-2"></i>Dijital Kimlik Denetimi
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning mb-4" role="alert">
                    <i class="bx bx-info-circle me-1"></i>
                    <strong>Demo:</strong> Bu form sadece gosterim amaclıdır. Gercek kimlik dogrulamasi yapmaz.
                </div>

                <form id="identityForm" novalidate>
                    <div class="mb-3">
                        <label for="fullName" class="form-label">Ad Soyad</label>
                        <input type="text" class="form-control" id="fullName" name="fullName"
                               placeholder="Adinizi ve soyadinizi girin">
                    </div>

                    <div class="mb-3">
                        <label for="tcNo" class="form-label">T.C. Kimlik No</label>
                        <input type="text" class="form-control" id="tcNo" name="tcNo"
                               maxlength="11" placeholder="11 haneli T.C. kimlik numarasi">
                        <div id="tcHelp" class="form-text">
                            T.C. kimlik numarasi 11 haneli olmali ve 0 ile baslamamali.
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="birthDate" class="form-label">Dogum Tarihi</label>
                        <input type="date" class="form-control" id="birthDate" name="birthDate">
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">E-posta</label>
                        <input type="email" class="form-control" id="email" name="email"
                               placeholder="ornek@email.com">
                    </div>

                    <div class="mb-3">
                        <label for="phone" class="form-label">Telefon</label>
                        <input type="tel" class="form-control" id="phone" name="phone"
                               placeholder="05XXXXXXXXX" maxlength="11">
                    </div>

                    <div class="mb-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="approve" name="approve">
                            <label class="form-check-label" for="approve">
                                Bilgilerin bana ait oldugunu onayliyorum
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bx bx-check-shield me-1"></i> Kimligi Dogrula
                    </button>
                </form>

                <!-- Sonuc Mesaji -->
                <div id="resultMessage" class="alert mt-4 d-none" role="alert" aria-live="polite"></div>
            </div>
        </div>

        <!-- T.C. Kimlik Algoritmasi -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0">T.C. Kimlik Numarasi Algoritmasi</h6>
            </div>
            <div class="card-body">
                <p class="text-muted small mb-3">
                    T.C. kimlik numarasi 11 haneli bir sayidir ve belirli matematiksel kurallara uyar:
                </p>
                <ul class="small mb-0">
                    <li>11 haneli olmalidir</li>
                    <li>Ilk hane 0 olamaz</li>
                    <li>Ilk 10 hanenin toplami mod 10, 11. haneyi verir</li>
                    <li>Tek siralardaki rakamlarin toplami x 7, cift siralardaki rakamlarin toplami cikarilir. Sonuc mod 10, 10. haneyi verir</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section PageScripts {
<script>
    const form = document.getElementById('identityForm');
    const resultMessage = document.getElementById('resultMessage');

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        const fullName = document.getElementById('fullName').value.trim();
        const tcNo = document.getElementById('tcNo').value.trim();
        const birthDate = document.getElementById('birthDate').value;
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const approve = document.getElementById('approve').checked;

        // Onceki mesaji temizle
        resultMessage.className = 'alert mt-4';
        resultMessage.classList.remove('d-none');

        // Bos alan kontrolu
        if (!fullName || !tcNo || !birthDate || !email || !phone) {
            showError('Lutfen tum alanlari doldurun.');
            return;
        }

        // Onay kontrolu
        if (!approve) {
            showError('Kimlik onayı gereklidir.');
            return;
        }

        // T.C. Kimlik numarasi kontrolu
        if (!validateTC(tcNo)) {
            showError('Gecersiz T.C. Kimlik Numarasi.');
            return;
        }

        // Yas kontrolu (18+)
        const age = calculateAge(birthDate);
        if (age < 18) {
            showError('18 yasindan kucukler dogrulanamaz.');
            return;
        }

        // Telefon kontrolu
        if (!/^05\d{9}$/.test(phone)) {
            showError('Gecersiz telefon numarasi. Format: 05XXXXXXXXX');
            return;
        }

        // Basarili
        showSuccess('<i class="bx bx-check me-1"></i> Kimlik dogrulama BASARILI (Demo)');
    });

    function showError(message) {
        resultMessage.className = 'alert alert-danger mt-4';
        resultMessage.innerHTML = '<i class="bx bx-error me-1"></i> ' + message;
        resultMessage.classList.remove('d-none');
    }

    function showSuccess(message) {
        resultMessage.className = 'alert alert-success mt-4';
        resultMessage.innerHTML = message;
        resultMessage.classList.remove('d-none');
    }

    function validateTC(tc) {
        // 11 haneli ve 0 ile baslamiyor mu?
        if (!/^[1-9][0-9]{10}$/.test(tc)) return false;

        const digits = tc.split('').map(Number);

        // Tek ve cift indexli rakamlarin toplami
        const odd = digits[0] + digits[2] + digits[4] + digits[6] + digits[8];
        const even = digits[1] + digits[3] + digits[5] + digits[7];

        // 10. ve 11. hane kontrolu
        const digit10 = ((odd * 7) - even) % 10;
        const digit11 = digits.slice(0, 10).reduce((a, b) => a + b, 0) % 10;

        return digit10 === digits[9] && digit11 === digits[10];
    }

    function calculateAge(birthDate) {
        const today = new Date();
        const birth = new Date(birthDate);

        let age = today.getFullYear() - birth.getFullYear();
        const monthDiff = today.getMonth() - birth.getMonth();

        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
            age--;
        }

        return age;
    }

    // Sadece rakam girisine izin ver (T.C. ve telefon alanlari)
    ['tcNo', 'phone'].forEach(id => {
        document.getElementById(id).addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '');
        });
    });
</script>
}
